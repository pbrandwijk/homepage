---
layout: post
title:  "Installing NVIDIA graphics driver"
date:   2018-10-11 23:30:00 +0200
tags:   
  - linux
  - ubuntu
  - driver
  - nvidia
  - graphics card
---
*What I did to solve an issue with my graphics driver.*

## Preliminaries
I'm using Ubuntu 18.04 as my OS on an HP Pavilion laptop with an NVIDIA GeForce GTX 1050 graphics card. *Update 2020-07-02: The information below also applies to Ubuntu 20.04, but that release installs its own version of the NVIDIA drivers, which may not be the version you need.*

## Issue
When installing Ubuntu, the screen freezes very quickly after boot. Both from USB and later from hard drive. A quick workaround was to press 'e' in GRUB2 boot menu and add 'nomodeset' after the word 'splash' on the line that starts with 'linux'. like this:
```
linux /boot/vmlinuz-linux root=UUID=978e3e81-8048-4ae1-8a06-aa727458e8ff quiet splash nomodeset
```
And then press `Ctrl+x` to boot. This had to be repeated at every boot. You could make this permanent by editing the `GRUB_CMDLINE_LINUX_DEFAULT` variable in `/etc/default/grub`.

## Solution
On Ubuntu 18.04, the correct driver for the graphics card was missing. On Ubuntu 20.04 the wrong version of the driver was installed. In this case, purge the packages like this:
```console
$ sudo apt purge nvidia*
```

I looked up the correct driver at the NVIDIA web site, in this case driver number 390, and executed in the terminal:
```console
$ sudo apt install nvidia-driver-390
$ nvidia-settings
```

The command `nvidia-settings` will give an error and say "driver is not loaded" if you do this immediately after install. For this to work you must first reboot the system. Then the driver will be loaded and the issue should be solved.

In `nvidia-settings` under the tab "PRIME profiles" you can select which graphics card to use. If you don't need the performance of your NVIDIA card you can change to another that consumes less power.

If after installing the NVIDIA card you cannot connect a second monitor via HDMI anymore, this is probably because prime-select writes a configuration file which causes the problem. It enables the nvidia-drm modeset option. You can solve this by commenting out this option. It will not be reset, because prime-select only writes this file when it does not yet exists.

Open the file with admit (sudo) rights:

```console
$ sudo nano /lib/modprobe.d/nvidia-kms.conf
```

And comment out the nvidia-drm modeset option:

```
# This file was generated by nvidia-prime
# Set value to 0 to disable modesetting
#options nvidia-drm modeset=1
```
